<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUJI Trip Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCS5dlfemU6PakoaTA1Zurg0xdYTxdVrzw&callback=initMap"></script>
    <style>
        body { background-color: #f5f5f5; color: #333; font-family: 'Helvetica', sans-serif; }
        .muji-card { background-color: #fff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 16px; margin-bottom: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .muji-button { background-color: #d2b48c; color: #fff; padding: 8px 16px; border-radius: 4px; cursor: pointer; }
        .muji-button:hover { background-color: #c0a080; }
        .muji-text { color: #808080; }
        .tag { background-color: #e5d5c0; color: #333; padding: 4px 8px; border-radius: 999px; font-size: 0.8rem; }
        .location-link { color: #2563eb; text-decoration: underline; }
        .location-link:hover { color: #1d4ed8; }
    </style>
</head>
<body class="max-w-md mx-auto p-4">
    <div id="app">
        <!-- Navigation Tabs -->
        <div class="flex justify-around mb-4 border-b border-gray-200">
            <button @click="currentTab = 'schedule'" :class="{ 'font-bold border-b-2 border-amber-600': currentTab === 'schedule' }" class="pb-2 px-4">Schedule</button>
            <button @click="currentTab = 'map'" :class="{ 'font-bold border-b-2 border-amber-600': currentTab === 'map' }" class="pb-2 px-4">Map</button>
            <button @click="currentTab = 'accounting'" :class="{ 'font-bold border-b-2 border-amber-600': currentTab === 'accounting' }" class="pb-2 px-4">Expenses</button>
            <button @click="currentTab = 'shopping'" :class="{ 'font-bold border-b-2 border-amber-600': currentTab === 'shopping' }" class="pb-2 px-4">Shopping List</button>
        </div>

        <!-- Schedule Tab -->
        <div v-if="currentTab === 'schedule'" class="muji-card">
            <h2 class="text-lg font-bold mb-4">Schedule</h2>
            <div v-if="weather" class="mb-4 muji-text">
                <p>Today's Weather: {{ weather.description }}, Temp: {{ weather.temp }}¬∞C</p>
            </div>

            <!-- Sorted Items -->
            <div v-for="(item, index) in sortedSchedule" :key="index">
                <!-- Flight Card -->
                <div v-if="item.type === 'flight'" class="muji-card mb-4 border-l-4 border-amber-700">
                    <div class="flex justify-between items-center mb-3">
                        <span class="font-bold text-lg">{{ item.flightNumber }} ‚Ä¢ {{ item.airline }}</span>
                        <button @click="removeSchedule(index)" class="text-red-500 text-sm">Delete</button>
                    </div>
                    <p class="text-sm muji-text mb-2">{{ formatDate(item.date) }} {{ item.time }}</p>
                    <div class="grid grid-cols-2 gap-4 mb-3">
                        <div>
                            <p class="text-sm muji-text">Departure</p>
                            <p class="font-semibold text-lg">{{ item.departTime }}</p>
                            <p class="text-gray-600">{{ item.departAirport }}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm muji-text">Arrival</p>
                            <p class="font-semibold text-lg">{{ item.arriveTime }}</p>
                            <p class="text-gray-600">{{ item.arriveAirport }}</p>
                        </div>
                    </div>
                    <div class="flex gap-2 flex-wrap mb-2">
                        <span v-for="person in item.people" :key="person" class="tag">{{ person }}</span>
                    </div>
                    <p v-if="item.notes" class="text-sm muji-text mt-2"><strong>Notes:</strong> {{ item.notes }}</p>
                </div>

                <!-- General Activity -->
                <div v-else class="muji-card mb-4">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <p class="font-semibold">{{ item.time }} - {{ item.event }}</p>
                            <p class="text-sm muji-text">{{ formatDate(item.date) }}</p>
                            <div v-if="item.location" class="mt-2">
                                <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(item.location)" target="_blank" class="location-link flex items-center">
                                    üìç {{ item.location }}
                                </a>
                            </div>
                            <div class="flex gap-2 flex-wrap mt-2">
                                <span v-for="person in item.people" :key="person" class="tag">{{ person }}</span>
                            </div>
                            <p v-if="item.notes" class="text-sm muji-text mt-2"><strong>Notes:</strong> {{ item.notes }}</p>
                        </div>
                        <button @click="removeSchedule(index)" class="text-red-500 text-sm">Delete</button>
                    </div>
                </div>
            </div>

            <!-- Add New -->
            <select v-model="newSchedule.type" class="border p-2 mb-3 w-full rounded">
                <option value="normal">General Activity</option>
                <option value="flight">Flight</option>
            </select>

            <input type="date" v-model="newSchedule.date" class="border p-2 mb-2 w-full rounded" required>
            <input type="time" v-model="newSchedule.time" class="border p-2 mb-2 w-full rounded" required>

            <!-- People Checkboxes -->
            <div class="mb-4">
                <p class="text-sm muji-text mb-2">Who?</p>
                <label class="flex items-center mb-2"><input type="checkbox" v-model="newSchedule.people" value="Nickel" class="mr-2"> Nickel</label>
                <label class="flex items-center mb-2"><input type="checkbox" v-model="newSchedule.people" value="Lily" class="mr-2"> Lily</label>
                <label class="flex items-center mb-2"><input type="checkbox" v-model="newSchedule.people" value="Candis" class="mr-2"> Candis</label>
            </div>

            <!-- General Activity Fields -->
            <div v-if="newSchedule.type === 'normal'">
                <input v-model="newSchedule.event" placeholder="Event" class="border p-2 mb-2 w-full rounded" required>
                <input v-model="newSchedule.location" placeholder="Location (e.g. Taipei 101)" class="border p-2 mb-2 w-full rounded">
            </div>

            <!-- Flight Fields -->
            <div v-if="newSchedule.type === 'flight'">
                <input v-model="newSchedule.flightNumber" placeholder="Flight Number (e.g. CX123)" class="border p-2 mb-2 w-full rounded">
                <input v-model="newSchedule.airline" placeholder="Airline" class="border p-2 mb-2 w-full rounded">
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <input v-model="newSchedule.departTime" placeholder="Depart Time (e.g. 14:00)" class="border p-2 mb-2 w-full rounded">
                        <input v-model="newSchedule.departAirport" placeholder="Depart Airport (e.g. HKG)" class="border p-2 mb-2 w-full rounded">
                    </div>
                    <div>
                        <input v-model="newSchedule.arriveTime" placeholder="Arrive Time (e.g. 16:00)" class="border p-2 mb-2 w-full rounded">
                        <input v-model="newSchedule.arriveAirport" placeholder="Arrive Airport (e.g. TPE)" class="border p-2 mb-2 w-full rounded">
                    </div>
                </div>
            </div>

            <!-- Notes (for both types) -->
            <textarea v-model="newSchedule.notes" placeholder="Notes (optional)" class="border p-2 mb-3 w-full rounded h-24"></textarea>

            <button @click="addSchedule" class="muji-button w-full mt-3">Add</button>
        </div>

        <!-- Map, Expenses, Shopping Tabs (unchanged, omitted for brevity) -->
        <!-- If you need the full code with them, just say! -->

        <script>
            const { createApp } = Vue;
            createApp({
                data() {
                    return {
                        currentTab: 'schedule',
                        schedule: [],
                        newSchedule: {
                            type: 'normal',
                            date: '',
                            time: '',
                            event: '',
                            location: '',
                            flightNumber: '', airline: '',
                            departTime: '', departAirport: '',
                            arriveTime: '', arriveAirport: '',
                            notes: '',
                            people: []
                        },
                        weather: null,
                        destination: '',
                        map: null,
                        directionsService: null,
                        directionsRenderer: null,
                        // ... accounting, shoppingList etc.
                    };
                },
                computed: {
                    sortedSchedule() {
                        return [...this.schedule].sort((a, b) => {
                            if (a.date !== b.date) return a.date.localeCompare(b.date);
                            return a.time.localeCompare(b.time);
                        });
                    }
                },
                methods: {
                    formatDate(dateStr) {
                        if (!dateStr) return '';
                        const date = new Date(dateStr);
                        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                    },
                    addSchedule() {
                        if (this.newSchedule.date && this.newSchedule.time && this.newSchedule.people.length > 0) {
                            if (this.newSchedule.type === 'normal' && this.newSchedule.event ||
                                this.newSchedule.type === 'flight' && this.newSchedule.flightNumber) {
                                this.schedule.push({ ...this.newSchedule });
                                this.newSchedule = {
                                    type: 'normal', date: '', time: '', event: '', location: '',
                                    flightNumber: '', airline: '', departTime: '', departAirport: '',
                                    arriveTime: '', arriveAirport: '', notes: '', people: []
                                };
                            }
                        }
                    },
                    removeSchedule(index) {
                        this.schedule.splice(index, 1);
                    },
                    async fetchWeather() {
                        const apiKey = 'YOUR_OPENWEATHER_API_KEY'; // Remember to add this too!
                        const city = 'Taipei';
                        const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`;
                        try {
                            const response = await fetch(url);
                            const data = await response.json();
                            this.weather = { description: data.weather[0].description, temp: Math.round(data.main.temp) };
                        } catch (error) { console.error('Weather error:', error); }
                    },
                    initMap() { /* same as before */ },
                    navigateToDestination() { /* same as before */ }
                    // ... other methods
                },
                mounted() {
                    this.fetchWeather();
                    window.initMap = this.initMap;
                }
            }).mount('#app');
        </script>
    </div>
</body>
</html>
