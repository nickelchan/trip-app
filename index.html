<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>一不做二不休 2026日韓起雙飛</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCS5dlfemU6PakoaTA1Zurg0xdYTxdVrzw&callback=initMap"></script>
    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyABKRa_5mNKQfwPkyJajjEqV37y2yL8yFY",
          authDomain: "seoultokyo-2026.firebaseapp.com",
          projectId: "seoultokyo-2026",
          storageBucket: "seoultokyo-2026.firebasestorage.app",
          messagingSenderId: "850066764296",
          appId: "1:850066764296:web:af1bd91fd681f2c37197bd"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>
    <style>
        /* 同之前一樣，略 */
    </style>
</head>
<body class="max-w-md mx-auto p-4">
    <div id="app">
        <!-- Trip Code + Tabs 同之前一樣 -->

        <!-- Expenses Tab (新版) -->
        <div v-if="currentTab === 'accounting'" class="card">
            <h2 class="text-lg font-bold mb-4">Expenses</h2>

            <div v-for="(entry, index) in sortedAccounting" :key="entry.id || index" class="card mb-4">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <p class="font-semibold text-lg">{{ entry.amount }} {{ entry.currency }} <span class="text-sm text-muted">(≈ {{ toHKD(entry.amount, entry.currency).toFixed(2) }} HKD)</span></p>
                        <p class="text-sm text-muted">{{ formatDate(entry.date) }} {{ entry.time || '' }}</p>
                        <p>{{ entry.description }}</p>
                        <p v-if="entry.store" class="text-sm text-muted mt-1"><strong>Store:</strong> {{ entry.store }}</p>
                        <div class="flex gap-2 flex-wrap mt-2">
                            <span class="tag">{{ entry.person }}</span>
                        </div>
                    </div>
                    <div>
                        <button @click="startEditAccounting(entry, index)" class="edit-btn mr-2">Edit</button>
                        <button @click="removeAccounting(entry.id, index)" class="text-red-500 text-sm">Delete</button>
                    </div>
                </div>
            </div>

            <!-- 總結區 -->
            <div class="card mt-8 bg-amber-50">
                <h3 class="font-bold mb-4">Trip Summary (in HKD)</h3>
                <p>Total Expenses: <strong>{{ totalHKD.toFixed(2) }} HKD</strong></p>
                <p>Average per person: <strong>{{ averageHKD.toFixed(2) }} HKD</strong></p>
                <div class="mt-4">
                    <p v-for="person in ['Nickel', 'Lily', 'Candis']" :key="person">
                        <strong>{{ person }}:</strong> Paid {{ personPaidHKD(person).toFixed(2) }} HKD → 
                        <span :class="settleAmount(person) > 0 ? 'text-red-600' : 'text-green-600'">
                            {{ settleAmount(person) > 0 ? 'Owes' : 'Should receive' }} {{ Math.abs(settleAmount(person)).toFixed(2) }} HKD
                        </span>
                    </p>
                </div>
            </div>

            <!-- Add/Edit Form 同之前一樣 -->
        </div>

        <!-- 其他 Tab 同之前 -->

    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    // ... 所有之前 data
                };
            },
            computed: {
                // ... 之前 computed
                totalHKD() {
                    return this.accounting.reduce((sum, entry) => sum + this.toHKD(entry.amount, entry.currency), 0);
                }
            },
            methods: {
                // ... 之前所有 methods
                toHKD(amount, currency) {
                    const rates = {
                        HKD: 1,
                        CAD: 5.68,
                        JPY: 0.0497,
                        KRW: 0.0054
                    };
                    return amount * (rates[currency] || 1);
                },
                personPaidHKD(person) {
                    return this.accounting
                        .filter(e => e.person === person)
                        .reduce((sum, e) => sum + this.toHKD(e.amount, e.currency), 0);
                },
                averageHKD() {
                    return this.totalHKD / 3;
                },
                settleAmount(person) {
                    return this.personPaidHKD(person) - this.averageHKD();
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
