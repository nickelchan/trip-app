<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUJI Trip Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCS5dlfemU6PakoaTA1Zurg0xdYTxdVrzw&callback=initMap"></script>
    <style>
        body { background-color: #f5f5f5; color: #333; font-family: 'Helvetica', sans-serif; }
        .muji-card { background-color: #fff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 16px; margin-bottom: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .muji-button { background-color: #d2b48c; color: #fff; padding: 8px 16px; border-radius: 4px; cursor: pointer; }
        .muji-button:hover { background-color: #c0a080; }
        .muji-text { color: #808080; }
        .tag { background-color: #e5d5c0; color: #333; padding: 4px 8px; border-radius: 999px; font-size: 0.8rem; }
        .location-link { color: #2563eb; text-decoration: underline; }
        .location-link:hover { color: #1d4ed8; }
        .edit-button { background-color: #a0a0a0; color: #fff; padding: 4px 8px; font-size: 0.8rem; border-radius: 4px; }
        .edit-button:hover { background-color: #909090; }
    </style>
</head>
<body class="max-w-md mx-auto p-4">
    <div id="app">
        <!-- Navigation Tabs -->
        <div class="flex justify-around mb-4 border-b border-gray-200 bg-white sticky top-0 z-10 py-2">
            <button @click="currentTab = 'schedule'" :class="{ 'font-bold border-b-2 border-amber-600': currentTab === 'schedule' }" class="pb-2 px-4">Schedule</button>
            <button @click="currentTab = 'map'" :class="{ 'font-bold border-b-2 border-amber-600': currentTab === 'map' }" class="pb-2 px-4">Map</button>
            <button @click="currentTab = 'accounting'" :class="{ 'font-bold border-b-2 border-amber-600': currentTab === 'accounting' }" class="pb-2 px-4">Expenses</button>
            <button @click="currentTab = 'shopping'" :class="{ 'font-bold border-b-2 border-amber-600': currentTab === 'shopping' }" class="pb-2 px-4">Shopping</button>
        </div>

        <!-- Schedule Tab -->
        <div v-if="currentTab === 'schedule'" class="muji-card">
            <h2 class="text-lg font-bold mb-4">Schedule</h2>
            <div v-if="weather" class="mb-4 muji-text">
                <p>Today's Weather: {{ weather.description }}, Temp: {{ weather.temp }}¬∞C</p>
            </div>

            <div v-for="(item, index) in sortedSchedule" :key="index">
                <!-- Flight -->
                <div v-if="item.type === 'flight'" class="muji-card mb-4 border-l-4 border-amber-700">
                    <div class="flex justify-between items-center mb-3">
                        <span class="font-bold text-lg">{{ item.flightNumber }} ‚Ä¢ {{ item.airline }}</span>
                        <div>
                            <button @click="startEditSchedule(index)" class="edit-button mr-2">Edit</button>
                            <button @click="removeSchedule(index)" class="text-red-500 text-sm">Delete</button>
                        </div>
                    </div>
                    <p class="text-sm muji-text mb-2">{{ formatFlightDate(item.departDate, item.arriveDate) }}</p>
                    <div class="grid grid-cols-2 gap-4 mb-3">
                        <div>
                            <p class="text-sm muji-text">Departure</p>
                            <p class="font-semibold text-lg">{{ item.departTime }}</p>
                            <p class="text-gray-600">{{ item.departAirport }}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm muji-text">Arrival</p>
                            <p class="font-semibold text-lg">{{ item.arriveTime }}</p>
                            <p class="text-gray-600">{{ item.arriveAirport }}</p>
                        </div>
                    </div>
                    <div class="flex gap-2 flex-wrap mb-2">
                        <span v-for="person in item.people" :key="person" class="tag">{{ person }}</span>
                    </div>
                    <p v-if="item.notes" class="text-sm muji-text mt-2"><strong>Notes:</strong> {{ item.notes }}</p>
                </div>

                <!-- General Activity -->
                <div v-else class="muji-card mb-4">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <p class="font-semibold">{{ item.time }} - {{ item.event }}</p>
                            <p class="text-sm muji-text">{{ formatDate(item.date) }}</p>
                            <div v-if="item.location" class="mt-2">
                                <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(item.location)" target="_blank" class="location-link flex items-center">
                                    üìç {{ item.location }}
                                </a>
                            </div>
                            <div class="flex gap-2 flex-wrap mt-2">
                                <span v-for="person in item.people" :key="person" class="tag">{{ person }}</span>
                            </div>
                            <p v-if="item.notes" class="text-sm muji-text mt-2"><strong>Notes:</strong> {{ item.notes }}</p>
                        </div>
                        <div>
                            <button @click="startEditSchedule(index)" class="edit-button mr-2">Edit</button>
                            <button @click="removeSchedule(index)" class="text-red-500 text-sm">Delete</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add/Edit Form -->
            <div class="mt-8">
                <h3 class="font-semibold mb-4">{{ editScheduleIndex !== null ? 'Edit Item' : 'Add New' }}</h3>
                <select v-model="newSchedule.type" class="border p-2 mb-3 w-full rounded">
                    <option value="normal">General Activity</option>
                    <option value="flight">Flight</option>
                </select>

                <div v-if="newSchedule.type === 'normal'">
                    <input type="date" v-model="newSchedule.date" class="border p-2 mb-2 w-full rounded" required>
                    <input type="time" v-model="newSchedule.time" class="border p-2 mb-2 w-full rounded" required>
                </div>

                <div v-if="newSchedule.type === 'flight'">
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <div>
                            <p class="text-sm muji-text mb-1">Departure Date</p>
                            <input type="date" v-model="newSchedule.departDate" class="border p-2 w-full rounded" required>
                        </div>
                        <div>
                            <p class="text-sm muji-text mb-1">Arrival Date (if different)</p>
                            <input type="date" v-model="newSchedule.arriveDate" class="border p-2 w-full rounded">
                        </div>
                    </div>
                </div>

                <div class="mb-4">
                    <p class="text-sm muji-text mb-2">Who?</p>
                    <label class="flex items-center mb-2"><input type="checkbox" v-model="newSchedule.people" value="Nickel" class="mr-2"> Nickel</label>
                    <label class="flex items-center mb-2"><input type="checkbox" v-model="newSchedule.people" value="Lily" class="mr-2"> Lily</label>
                    <label class="flex items-center mb-2"><input type="checkbox" v-model="newSchedule.people" value="Candis" class="mr-2"> Candis</label>
                </div>

                <div v-if="newSchedule.type === 'normal'">
                    <input v-model="newSchedule.event" placeholder="Event" class="border p-2 mb-2 w-full rounded" required>
                    <input v-model="newSchedule.location" placeholder="Location (e.g. Taipei 101)" class="border p-2 mb-2 w-full rounded">
                </div>

                <div v-if="newSchedule.type === 'flight'">
                    <input v-model="newSchedule.flightNumber" placeholder="Flight Number" class="border p-2 mb-2 w-full rounded" required>
                    <input v-model="newSchedule.airline" placeholder="Airline" class="border p-2 mb-2 w-full rounded">
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <input v-model="newSchedule.departTime" placeholder="Depart Time" class="border p-2 mb-2 w-full rounded" required>
                            <input v-model="newSchedule.departAirport" placeholder="Depart Airport" class="border p-2 mb-2 w-full rounded" required>
                        </div>
                        <div>
                            <input v-model="newSchedule.arriveTime" placeholder="Arrive Time" class="border p-2 mb-2 w-full rounded" required>
                            <input v-model="newSchedule.arriveAirport" placeholder="Arrive Airport" class="border p-2 mb-2 w-full rounded" required>
                        </div>
                    </div>
                </div>

                <textarea v-model="newSchedule.notes" placeholder="Notes (optional)" class="border p-2 mb-3 w-full rounded h-24"></textarea>

                <div class="flex gap-2">
                    <button @click="saveSchedule" class="muji-button flex-1">{{ editScheduleIndex !== null ? 'Save Changes' : 'Add' }}</button>
                    <button v-if="editScheduleIndex !== null" @click="cancelEditSchedule" class="bg-gray-500 text-white px-4 py-2 rounded">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Map Tab -->
        <div v-if="currentTab === 'map'" class="muji-card">
            <h2 class="text-lg font-bold mb-4">Map & Navigation</h2>
            <input v-model="destination" placeholder="Enter destination" class="border p-2 mb-2 w-full rounded">
            <button @click="navigateToDestination" class="muji-button mb-4 w-full">Navigate</button>
            <div id="map" class="h-80 w-full rounded-lg overflow-hidden"></div>
        </div>

        <!-- Expenses Tab -->
        <div v-if="currentTab === 'accounting'" class="muji-card">
            <h2 class="text-lg font-bold mb-4">Expenses</h2>

            <div v-for="(entry, index) in sortedAccounting" :key="index" class="muji-card mb-4">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <p class="font-semibold text-lg">{{ entry.amount }} {{ entry.currency }}</p>
                        <p class="text-sm muji-text">{{ formatDate(entry.date) }} {{ entry.time || '' }}</p>
                        <p>{{ entry.description }}</p>
                        <p v-if="entry.store" class="text-sm muji-text mt-1"><strong>Store:</strong> {{ entry.store }}</p>
                        <div class="flex gap-2 flex-wrap mt-2">
                            <span class="tag">{{ entry.person }}</span>
                        </div>
                    </div>
                    <div>
                        <button @click="startEditAccounting(index)" class="edit-button mr-2">Edit</button>
                        <button @click="removeAccounting(index)" class="text-red-500 text-sm">Delete</button>
                    </div>
                </div>
            </div>

            <div class="mt-8">
                <h3 class="font-semibold mb-4">{{ editAccountingIndex !== null ? 'Edit Expense' : 'Add Expense' }}</h3>
                <input type="date" v-model="newAccounting.date" class="border p-2 mb-2 w-full rounded" required>
                <input type="time" v-model="newAccounting.time" class="border p-2 mb-2 w-full rounded">
                <select v-model="newAccounting.person" class="border p-2 mb-2 w-full rounded">
                    <option>Nickel</option>
                    <option>Lily</option>
                    <option>Candis</option>
                </select>
                <input v-model="newAccounting.amount" type="number" placeholder="Amount" class="border p-2 mb-2 w-full rounded" required>
                <select v-model="newAccounting.currency" class="border p-2 mb-2 w-full rounded">
                    <option value="HKD">HKD</option>
                    <option value="CAD">CAD</option>
                    <option value="JPY">JPY</option>
                    <option value="KRW">KRW</option>
                </select>
                <input v-model="newAccounting.description" placeholder="Description" class="border p-2 mb-2 w-full rounded" required>
                <input v-model="newAccounting.store" placeholder="Store / Shop (optional)" class="border p-2 mb-2 w-full rounded">
                <div class="flex gap-2 mt-4">
                    <button @click="saveAccounting" class="muji-button flex-1">{{ editAccountingIndex !== null ? 'Save Changes' : 'Add Expense' }}</button>
                    <button v-if="editAccountingIndex !== null" @click="cancelEditAccounting" class="bg-gray-500 text-white px-4 py-2 rounded">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Shopping List Tab -->
        <div v-if="currentTab === 'shopping'" class="muji-card">
            <h2 class="text-lg font-bold mb-4">Shopping List</h2>
            <ul class="mb-6">
                <li v-for="(item, index) in shoppingList" :key="index" class="mb-3 flex justify-between items-center">
                    <span>{{ item }}</span>
                    <div>
                        <button @click="startEditShopping(index)" class="edit-button mr-2">Edit</button>
                        <button @click="removeShopping(index)" class="text-red-500 text-sm">Delete</button>
                    </div>
                </li>
            </ul>

            <div class="mt-8">
                <h3 class="font-semibold mb-4">{{ editShoppingIndex !== null ? 'Edit Item' : 'Add New Item' }}</h3>
                <input v-model="newShopping" placeholder="Item name" class="border p-2 mb-2 w-full rounded">
                <div class="flex gap-2 mt-4">
                    <button @click="saveShopping" class="muji-button flex-1">{{ editShoppingIndex !== null ? 'Save Changes' : 'Add' }}</button>
                    <button v-if="editShoppingIndex !== null" @click="cancelEditShopping" class="bg-gray-500 text-white px-4 py-2 rounded">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    currentTab: 'schedule',
                    schedule: [],
                    newSchedule: {
                        type: 'normal', date: '', time: '', event: '', location: '',
                        flightNumber: '', airline: '', departDate: '', departTime: '', departAirport: '',
                        arriveDate: '', arriveTime: '', arriveAirport: '', notes: '', people: []
                    },
                    editScheduleIndex: null,
                    accounting: [],
                    newAccounting: { person: 'Nickel', amount: '', currency: 'HKD', description: '', store: '', date: '', time: '' },
                    editAccountingIndex: null,
                    shoppingList: [],
                    newShopping: '',
                    editShoppingIndex: null,
                    weather: null,
                    destination: '',
                    map: null,
                    directionsService: null,
                    directionsRenderer: null
                };
            },
            computed: {
                sortedSchedule() {
                    return [...this.schedule].sort((a, b) => {
                        const dateA = a.type === 'flight' ? a.departDate : a.date;
                        const dateB = b.type === 'flight' ? b.departDate : b.date;
                        return dateA.localeCompare(dateB);
                    });
                },
                sortedAccounting() {
                    return [...this.accounting].sort((a, b) => b.date.localeCompare(a.date));
                }
            },
            methods: {
                formatDate(dateStr) {
                    if (!dateStr) return '';
                    const date = new Date(dateStr);
                    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                },
                formatFlightDate(depart, arrive) {
                    if (!depart) return '';
                    const d = this.formatDate(depart);
                    if (arrive && depart !== arrive) return d + ' ‚Üí ' + this.formatDate(arrive);
                    return d;
                },
                startEditSchedule(index) {
                    this.editScheduleIndex = index;
                    this.newSchedule = { ...this.schedule[index], people: [...this.schedule[index].people] };
                },
                cancelEditSchedule() {
                    this.editScheduleIndex = null;
                    this.resetNewSchedule();
                },
                saveSchedule() {
                    if (this.newSchedule.people.length > 0) {
                        const valid = (this.newSchedule.type === 'normal' && this.newSchedule.date && this.newSchedule.time && this.newSchedule.event) ||
                                      (this.newSchedule.type === 'flight' && this.newSchedule.departDate && this.newSchedule.departTime && this.newSchedule.arriveTime && this.newSchedule.flightNumber);
                        if (valid) {
                            if (this.editScheduleIndex !== null) {
                                this.schedule[this.editScheduleIndex] = { ...this.newSchedule };
                                this.editScheduleIndex = null;
                            } else {
                                this.schedule.push({ ...this.newSchedule });
                            }
                            this.resetNewSchedule();
                        }
                    }
                },
                resetNewSchedule() {
                    this.newSchedule = { type: 'normal', date: '', time: '', event: '', location: '',
                        flightNumber: '', airline: '', departDate: '', departTime: '', departAirport: '',
                        arriveDate: '', arriveTime: '', arriveAirport: '', notes: '', people: [] };
                },
                removeSchedule(index) { this.schedule.splice(index, 1); },
                startEditAccounting(index) {
                    this.editAccountingIndex = index;
                    this.newAccounting = { ...this.accounting[index] };
                },
                cancelEditAccounting() {
                    this.editAccountingIndex = null;
                    this.newAccounting = { person: 'Nickel', amount: '', currency: 'HKD', description: '', store: '', date: '', time: '' };
                },
                saveAccounting() {
                    if (this.newAccounting.date && this.newAccounting.amount && this.newAccounting.description) {
                        if (this.editAccountingIndex !== null) {
                            this.accounting[this.editAccountingIndex] = { ...this.newAccounting };
                            this.editAccountingIndex = null;
                        } else {
                            this.accounting.push({ ...this.newAccounting });
                        }
                        this.newAccounting = { person: 'Nickel', amount: '', currency: 'HKD', description: '', store: '', date: '', time: '' };
                    }
                },
                removeAccounting(index) { this.accounting.splice(index, 1); },
                startEditShopping(index) {
                    this.editShoppingIndex = index;
                    this.newShopping = this.shoppingList[index];
                },
                cancelEditShopping() {
                    this.editShoppingIndex = null;
                    this.newShopping = '';
                },
                saveShopping() {
                    if (this.newShopping.trim()) {
                        if (this.editShoppingIndex !== null) {
                            this.shoppingList[this.editShoppingIndex] = this.newShopping;
                            this.editShoppingIndex = null;
                        } else {
                            this.shoppingList.push(this.newShopping);
                        }
                        this.newShopping = '';
                    }
                },
                removeShopping(index) { this.shoppingList.splice(index, 1); },
                async fetchWeather() {
                    const apiKey = 'YOUR_OPENWEATHER_API_KEY'; // Â¶ÇÈúÄÂ§©Ê∞£Ë´ãÂ°´
                    const city = 'Taipei';
                    const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`;
                    try {
                        const response = await fetch(url);
                        const data = await response.json();
                        this.weather = { description: data.weather[0].description, temp: Math.round(data.main.temp) };
                    } catch (error) { console.error('Weather error:', error); }
                },
                initMap() {
                    this.map = new google.maps.Map(document.getElementById('map'), { center: { lat: 25.0330, lng: 121.5654 }, zoom: 12 });
                    this.directionsService = new google.maps.DirectionsService();
                    this.directionsRenderer = new google.maps.DirectionsRenderer();
                    this.directionsRenderer.setMap(this.map);
                },
                navigateToDestination() {
                    if (!this.destination) return;
                    navigator.geolocation.getCurrentPosition(position => {
                        const origin = { lat: position.coords.latitude, lng: position.coords.longitude };
                        const request = { origin, destination: this.destination, travelMode: 'DRIVING' };
                        this.directionsService.route(request, (result, status) => {
                            if (status === 'OK') this.directionsRenderer.setDirections(result);
                        });
                    }, () => alert('Please allow location access for navigation'));
                }
            },
            mounted() {
                this.fetchWeather();
                window.initMap = this.initMap;
            }
        }).mount('#app');
    </script>
</body>
</html>
